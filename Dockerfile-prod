
#buildStage
FROM node:14.5.0 as buildStage
ARG DB_PWD
ARG ADMIN_PASS
ARG SESSION_SECRET
ARG FACEBOOK_SECRET
ARG GOOGLE_SECRET
ARG LINKEDIN_SECRET
ARG CLOUDINARY_SECRET
ARG STRIP_SECRET_KEY
ARG SENDGRID_API_KEY
ARG ZOOM_SDK_SECRET
ARG ZOOM_SECRET
ARG ZOOM_CLIENT_SECRET
ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG AWS_DEFAULT_REGION


ENV DB_PWD=$DB_PWD
ENV ADMIN_PASS=$ADMIN_PASS
ENV SESSION_SECRET=$SESSION_SECRET
ENV FACEBOOK_SECRET=$FACEBOOK_SECRET
ENV GOOGLE_SECRET=$GOOGLE_SECRET
ENV LINKEDIN_SECRET=$LINKEDIN_SECRET
ENV CLOUDINARY_SECRET=$CLOUDINARY_SECRET
ENV STRIP_SECRET_KEY=$STRIP_SECRET_KEY
ENV SENDGRID_API_KEY=$SENDGRID_API_KEY
ENV ZOOM_SDK_SECRET=$ZOOM_SDK_SECRET
ENV ZOOM_SECRET=$ZOOM_SECRET
ENV ZOOM_CLIENT_SECRET=$ZOOM_CLIENT_SECRET
ENV AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID
ENV AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY
ENV AWS_DEFAULT_REGION=$AWS_DEFAULT_REGION

WORKDIR /streamme
RUN rm -rf node_modules
COPY package*.json ./
RUN npm install
RUN npm install -g wait-on
COPY . .

CMD NODE_ENV=production node server/server.js
EXPOSE 3000
